---
output: github_document
---
<!-- write-excel.md is generated from write-excel.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(dplyr)
library(implan)
```

## Overview

The implan package includes convenience functions for writing to Excel. This can be helpful for packaging multiple results (e.g., spending profiles) into a single file for easily sharing with colleagues. It uses [package openxlsx](https://ycphs.github.io/openxlsx/index.html).

### Initializing a Workbook

The first step is to create an Excel workbook using `xlsx_initialize_workbook()`. This makes an Excel file with a single "README" tab. I recommend always including a README for documentation (to be edited manually in Excel).

```{r}
library(dplyr)
library(implan)

xlsx_initialize_workbook("tmp.xlsx")
openxlsx::getSheetNames("tmp.xlsx")
```

### Adding Results

R data frames can be written directly to an Excel file with `xlsx_write_table()`:

```{r}
# use sample data from implan package
data(spending)
head(spending, 2)

xlsx_write_table(spending, "tmp.xlsx")
openxlsx::getSheetNames("tmp.xlsx")
```

### Updating Results

Additional calls to `xlsx_write_table()` will simply overwrite tabs with the same name, so you can easily update results. This does imply that you shouldn't manually edit the Excel file (other than the README tab).

```{r}
# update "spending" to show by category
data("item_to_category") 
left_join(spending, item_to_category, by = c("type", "item")) %>%
    mutate(spend = spend * share) %>%
    xlsx_write_table("tmp.xlsx", "spending")

openxlsx::readWorkbook("tmp.xlsx", "spending") %>% head(2)
```
